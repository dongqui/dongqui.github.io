---
layout: post
title: "copl.it(2) : 어떻게 망했나"
tags: [project]
---
코플잇 아키텍쳐 구성 중 삽질 회고....

## scenario
> 코플잇의 관리자를 생각해보자. 관리자는 유저가 풀어야할 과제의 기본 코드와 테스트케이스를 계속해서 업데이트 할 수 있는 개발자다. 이 관리자가 새로운 문제를 만들고자 할 때, 자기 스스로도 코드를 돌려보고 테스트케이스를 통과 시켜보는 과정이 필요하기 때문에 로컬에서 작업을 시작할 것이다. 로컬에서의 작업을 끝낸 후 실제 서비스에 적용되는 데이터를 업데이트 하려면 어떻게 해야할까?
가장 단순한 방법으로는 코드를 복사 붙여 넣든 해서 관리자 페이지를 이용해서 업데이트 할 수 있을 것이다.

<image1>

위 방법은 너무 번거로워 보였다... 로컬에서 작업 후에 git commit / push만으로 데이터를 업데이트 할 수 있다면 정말 편하지 않을까?
그래서 만들어진 아래의 아키텍쳐
<image2>

단순히 흐름만 보면,
1. 로컬에서 Folder Fairy 와 Git hooks를 통과 후 작업한 파일(코딩 문제, 테스트케이스)이 Github로 올라가게 된다.
2. Github에 걸어놓은 webhook이 실행돼서 커밋내용을 담은 payload를 우리 서버로 보내준다.
3. payload를 받은 서버는 commit내용을 분석하여 데이터베이스에 반영하고, Github에 올려진 파일들을 EBS에 pull 받게 된다.
4. 필요시에 file system을 이용해서 EBS에서 필요한 데이터를 가져와 쓴다.

2번, 3번 과정 부터 살펴보자.
Github에서 보내주는 payload는 다음과 같다.
<image3>


{% include image.html path="postimages/docker0.jpeg" path-detail="postimages/docker0.jpeg" alt="" %}



